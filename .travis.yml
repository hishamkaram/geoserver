dist: trusty
sudo: required

language: go
go:
  - "1.11.x"
  - "1.12.x"
  - "1.13.x"
  - "1.14.x"
  - "1.15.x"
services:
  - docker
env:
  - DOCKER_COMPOSE_VERSION=1.20.1 GS_VERSION=2.13.0 GO111MODULE=on
  - DOCKER_COMPOSE_VERSION=1.20.1 GS_VERSION=2.14.0 GO111MODULE=on
  - DOCKER_COMPOSE_VERSION=1.20.1 GS_VERSION=2.18.0 GO111MODULE=on

install: true

before_install:
  - docker-compose up -d
  - go get github.com/mattn/goveralls

script:
  - bash -c 'while [[ "$(curl -u admin:geoserver -s -o /dev/null -w ''%{http_code}'' localhost:8080/geoserver/rest/about/status)" != "200" ]]; do sleep 5 && echo "."; done'
  - go test -v -covermode=count -coverprofile=coverage.out
  - $GOPATH/bin/goveralls -coverprofile=coverage.out -service=travis-ci -repotoken $COVERALLS_TOKEN

